AWSTemplateFormatVersion: '2010-09-09'
Description: Weather lambda dashboard
Parameters:
  Service:
    Description: The name of the service
    Type: String
  ServiceMetricPrefix:
    Description: The name of the service, with all non-alphanumeric characters replaced by _. Use this for queries involving `Service` in metric names
    Type: String

Resources:
  DatadogTimeboard:
    Type: Custom::DatadogTimeboard
    Properties:
      ServiceToken: arn:aws:sns:eu-west-1:351350304555:datadog-custom-resource
      Title: !Sub i-ntothenetwork â€” ${Service}
      Description: !Sub ${ServiceMetricPrefix} dashboard
      Graphs:
        - title: Lambda Invocations
          definition:
            requests:
              - q: !Sub sum:aws.lambda.invocations{service:${Service}}.as_rate()
                type: area
        - title: Lambda Errors and Throttles
          definition:
            requests:
              - q: !Sub sum:aws.lambda.throttles{service:${Service}}.as_rate(),
                  sum:aws.lambda.errors{service:${Service}}.as_rate()
                type: area
